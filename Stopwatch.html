<!DOCTYPE html>

<html manifest="Stopwatch.manifest">
  <head>
    <title>Stopwatch</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <meta name="Author" content="MÃ¡rcio Faustino"/>
    <link rel="shortcut icon" type="image/x-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABAAAAAQCAYAAAAf8/9hAAAABGdBTUEAAK/INwWK6QAAABl0RVh0U29mdHdhcmUAQWRvYmUgSW1hZ2VSZWFkeXHJZTwAAAMESURBVDjLXZNrSFNxGMYPgQQRfYv6EgR9kCgKohtFgRAVQUHQh24GQReqhViWlVYbZJlZmZmombfVpJXTdHa3reM8uszmWpqnmQuX5drmLsdjenR7ev9DR3Xgd3h43+d5/pw/HA4AN9zITSPUhJ14R0xn87+h2ZzJvZVInJpzAQOXQOQMt+/5rvhMCLXv9Vjrt1rSXitmwj+Jua1+Ox+2HfGNdGf6yW8l5sUKPNVcRsiaPDA22Ahv6/7Ae/0aKdviQ0G7B/c6f8Zg+gbfh079Mjno0MhS58lflOsgEjh3BXc+bM/0DzbvDwj314znt/bjof0HdPw3FBq6kP+oCxVNfdDZvqPsrQmf6zdFRtyPJgbrFoqUTeS+FnPrekpmiC2lS+QcUx+qrf0wmFzodYfgC0nwhoYh9oegfdmLsmYXHj7JhV23erS7ZNYHyibGLiLtXsO19BoHSiwu6Ok09gwFg/gy8BO/STOkKFBk7EWh2YkLeh5Hy4Ws2B2w157iDvOpxw4UPRPRTSfL41FIsow7ZeXwUFF4dBQ1L96A/xLEFf1HMC/LxAt25PH+VN0HXH1gh2dEwdBoBGO0OKvW4L7hCdIvavBSsMIRVHCi0ArmZZl4wbYrz/yHSq1Ql9vQLylUEoE7GMal3OuxMG/7CO848N6n4HheK5iXZeIFmy88Nu+8aYJG24G3ziB+0Ee7wwqemlvQ5w9hcAJwyUDtpwBOFLeBeVkmXpB0qlK9RV2HlLsCsvUivHRhQwoQjhCkA1TgJX1OK0JVzIN5WSZesPZ44XKia+P5BqSS4aq+BzZXABLdhyQrsJPOqv4MVcEbMA/zsky8gLHyYO7hI9laecOZWuzLfYXU2zzSblmQerMZqjwTknOeY9dlIw5kVcrMG/8XpoQgCEkOhwNNJn5i7bFSrFDpsCrFEIPpLacr0WxpibYIQpS86/8pMBqNswnJ6XSivqHBv3R3pmbxzgwz4Z+EaTXtwqIogrzjxIJ4QVVV1UyihxgjFv3/K09Bu/lEkBgg5rLZH+fT5dvfn7iFAAAAAElFTkSuQmCC"/>
    <style type="text/css" media="screen">
body {
    margin: 0.4em;
}

form > * + * {
    margin-top: 0.4em;
}

form > * {
    display: block;
}

form > * > input {
    width: 100%;
}

#Time {
    padding-right: 6px;
}

#Pause > input,
#Reset > input {
    display: block;
    width: 100%;
    
    font-weight: bold;
    font-size: larger;
    letter-spacing: 0.1em;
}

#Time > input {
    display: block;
    
    border: 2px inset #56766D;
    background-color: #73A093;
    
    width: 100%;
    text-align: center;
    
    font-family: monospace;
    font-size: 1.75em;
    font-weight: bold;
}
    </style>
    
    <script type="text/javascript">
window.addEventListener('load', function() {
    var timeInput = document.querySelector('#Time > input');
    var pauseButton = document.querySelector('#Pause > input');
    var resetButton = document.querySelector('#Reset > input');
    
    var startMessage = pauseButton.value;
    var stopMessage = 'Stop';
    
    var hours = 0, minutes = 0, seconds = 0, hundred_secs = 0;
    var expires = new Date();
    var stopwatch;
    
    expires.setFullYear(expires.getFullYear() + 1);
    expires = ';expires=' + expires.toUTCString();
    
    function load() {
        var cookies = document.cookie.split(/\s*;\s*/);
        var state = {};
        
        for (var cookie; cookie = cookies.shift();) {
            var keyValue = cookie.split('=');
            state[keyValue[0]] = keyValue[1];
        }
        
        if (state.hours != undefined) {
            hours = Number(state.hours);
            minutes = Number(state.minutes);
            seconds = Number(state.seconds);
            hundred_secs = Number(state.hundred_secs);
        }
        
        if (state.pause == stopMessage) {
            var delay = new Date(Date.now() - Number(state.now));
            
            hours += delay.getUTCHours();
            minutes += delay.getUTCMinutes();
            seconds += delay.getUTCSeconds();
            hundred_secs += Math.round(delay.getUTCMilliseconds() / 100);
            
            pauseButton.click();
        }
        else {
            update();
        }
    }
    
    function save() {
        document.cookie = 'now=' + Date.now() + expires;
        document.cookie = 'pause=' + pauseButton.value + expires;
        document.cookie = 'hours=' + hours + expires;
        document.cookie = 'minutes=' + minutes + expires;
        document.cookie = 'seconds=' + seconds + expires;
        document.cookie = 'hundred_secs=' + hundred_secs + expires;
    }
    
    function tick() {
        ++hundred_secs;
        
        if (hundred_secs >= 100) {
            hundred_secs = 0;
            ++seconds;
            
            if (seconds >= 60) {
                seconds = 0;
                ++minutes;
                
                if (minutes >= 60) {
                    minutes = 0;
                    ++hours;
                    
                    if (hours >= 100) {
                        hours = 0;
                    }
                }
            }
        }
    }
    
    function update() {
        timeInput.value = 
            (hours < 10 ? '0' : '') + hours
            + ':' + (minutes < 10 ? '0' : '') + minutes
            + ':' + (seconds < 10 ? '0' : '') + seconds
            + ',' + (hundred_secs < 10 ? '0' : '') + hundred_secs;
    }
    
    pauseButton.addEventListener('click', function(event) {
        if (pauseButton.value == startMessage) {
            stopwatch = setInterval(function() {
                tick();
                update();
                save();
            }, 10);
            
            resetButton.disabled = true;
            pauseButton.value = stopMessage;
        }
        else {
            clearInterval(stopwatch);
            resetButton.disabled = false;
            pauseButton.value = startMessage;
        }
        
        save();
    }, false);
    
    resetButton.addEventListener('click', function(event) {
        hours = minutes = seconds = hundred_secs = 0;
        update();
        save();
    }, false);
    
    load();
}, false);
    </script>
  </head>
  
  <body>
    <form action="">
      <span id="Time"><input readonly="readonly" type="text" value="-"/></span>
      <span id="Pause"><input type="button" value="Start"/></span>
      <span id="Reset"><input type="button" value="Reset"/></span>
    </form>
  </body>
</html>
