from os import environ, path, pathsep


def Tools(env):
    tools = env['TOOLS']
    
    names = {
        'GNU': ['gcc', 'g++', 'mingw'],
        'MSVC': ['msvc'],
    }
    
    for (name, aliases) in names.items():
        for alias in aliases:
            if alias in tools:
                return name


np_api_sdk = path.join(environ['NP_API_SDK'], 'include')
libpurple_include_paths = environ['LIBPURPLE_INCLUDE_PATHS'].split(pathsep)

env = Environment(
    CPPPATH = [np_api_sdk] + libpurple_include_paths,
    #LIBS = ['purple'],
    WINDOWS_INSERT_DEF = True,
)

tools = Tools(env)
name = 'npMessaging'
files = Glob('*.cpp')

if tools == 'GNU':
    env.Append(CCFLAGS = ['-ansi', '-pedantic', '-Wall'])
elif tools == 'MSVC':
    files += env.RES(name + '.rc')
    env.Append(CCFLAGS = ['/EHsc'])

env.SharedLibrary(name, files)
